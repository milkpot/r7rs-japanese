\extrapart{言語の変更点}


\subsection*{\rfivers{}との非互換点}
\label{incompatibilities}

この節ではこの報告書と「報告書改$^5$」~\cite{R5RS}の間の非互換点を列挙します。

{\em この一覧には権威がありませんが、正確かつ完全であると信じられています。}


\begin{itemize}

\item シンボルおよび文字名の大文字小文字の区別はデフォルトになりました。
つまりシンボルをある文脈では{\cf FOO}または{\cf Foo}と書き
別の文脈では{\cf foo}と書くことができるという仮定の元で書かれたコードは
変更する必要があるか、新しい {\cf \#!fold-case}指令で印をつけるか、
{\cf include-ci}ライブラリ宣言を使ってライブラリにインクルードする必要がある
ということです。
標準の識別子はすべて完全に小文字です。

\item {\cf syntax-rules}構文は {\em \_} (アンダースコア)を
ワイルドカードとして認識するようになりました。
つまりこれを構文変数として使うことはできなくなったということです。
リテラルとしては未だ使うことができます。

\item \rfivers{}の手続き{\cf exact->\+inexact}および{\cf inexact->\+exact}は
それぞれ\rsixrs{}での名前{\cf inexact}および{\cf exact}に改名されました。
これらの名前はより短くより正確です。
前者の名前は\rfivers{}ライブラリで未だ利用可能です。

\item 文字列の比較({\cf string<?} およびそれ関連の述語による)は
文字の比較({\cf char<?} およびそれ関連の述語による)の辞書的な拡張であるという
保証は無くなりました。

\item 数値リテラル中の \# 文字のサポートはもはや要求されなくなりました。

\item 指数マーカーとしての文字{\cf s}、{\cf f}、{\cf d}、{\cf l}
のサポートはもはや要求されなくなりました。

\item {\cf string\coerce{}number}の実装は引数が明示的な基数接頭辞を持っているときに %
\schfalse{}を返すことがもはや認められなくなりました。
{\cf read}およびプログラム中の数値構文と互換でなければなりません。

\item 手続き{\cf transcript-on}および{\cf transcript-off}は削除されました。

\end{itemize}

\subsection*{それ以外の\rfivers{}以降の言語の変更点}
\label{differences}
この節ではこの報告書と「報告書改$^5$」~\cite{R5RS}の間の
さらなる違いを列挙しています。

{\em この一覧には権威がありませんが、正確かつ完全であると信じられています。}

\begin{itemize}

\item \rfivers{}におけるマイナーな曖昧な点や不明確な点が色々整理されました。

\item コードのカプセル化と共有を向上させるための新しいプログラム構造として
ライブラリが追加されました。
既存の識別子および新規の識別子は分離されたいくつかのライブラリに編成されました。
ライブラリは識別子のエクスポートや名前変更を制御しつつ
他のライブラリやメインプログラムにインポートされます。
ライブラリの内容は使われる処理系の機能に応じた条件分岐ができるようになりました。
\rfivers 互換ライブラリがあります。

\item 式型{\cf include}、{\cf include-ci}および{\cf cond-expand}が
baseライブラリに追加されました。
これらは対応するライブラリ宣言と同じ意味論を持っています。

\item {\cf raise}、{\cf raise-continuable}あるいは{\cf error}を用いて
明示的に例外を通知できるようになり、
{\cf with-\+exception-\+handler}および{\cf guard}構文を用いて
例外を処理できるようになりました。
エラーコンディションとして任意のオブジェクトを指定できます。
{\cf error}によって通知される処理系定義のコンディションには
それを検出するための述語および{\cf error}に渡された引数を取得するための
アクセサ関数があります。
{\cf read}およびファイル関連の手続きによって通知されるコンディションにも
それらを検出するための述語があります。

\item SRFI 9~\cite{srfi9}の{\cf define-record-type}を用いて
複数のフィールドへのアクセスをサポートする新しい独立した型を
生成できるようになりました。

\item {\cf make-parameter}を用いてパラメータオブジェクトを作成し、
{\cf parameterize}を用いてそれを動的に再束縛できます。
手続き{\cf current-\+input-\+port}および{\cf current-\+output-\+port}は
パラメータオブジェクトになりました。
新しく導入された{\cf current-\+error-\+port}も同様です。

\item プロミスに対するサポートが
SRFI 45~\cite{srfi45}に基づいて強化されました。

\item {\em バイトベクタ}と呼ばれる0〜255の正確整数のベクタが
新しい独立した型として追加されました。
ベクタの手続きのサブセットが提供されています。
UTF-8文字エンコーディングに従ってバイトベクタと文字列を相互に変換できます。
バイトベクタにはデータム表現があり、それ自身に評価されます。

\item ベクタ定数はそれ自身に評価されます。

\item 手続き{\cf read-line}が提供され、行指向のテキスト入力が簡単になりました。

\item 手続き{\cf flush-output-port}が提供され、
出力ポートのバッファリングに対する最低限の制御ができるようになりました。

\item {\em ポート}は
{\em テキスト}ポートまたは{\em バイナリ}ポートに指定されるようになり、
バイナリデータを読み書きするための新しい手続きが提供されます。
ポートが開いているか閉じられたかを返す
新しい述語{\cf input-port-open?} および{\cf output-port-open?} が追加されました。
ポートを閉じる新しい手続き{\cf close-port}が追加されました。
ポートが入力と出力を両方兼ねている場合はその両方が閉じられます。

\item 文字列に対して文字の読み書きを行う{\em 文字列ポート}と
バイトベクタに対してバイトの読み書きを行う{\em バイトベクタポート}が追加されました。

\item 文字列およびバイトベクタに固有の入出力手続きがあります。

\item {\cf write}手続きを循環オブジェクトに適用すると
データムラベルを生成するようになりました。
ラベルを生成しない新しい手続き{\cf write-simple}と
すべての共有構造および循環構造に対してラベルを生成する新しい手続き
{\cf write-shared}が追加されました。
{\cf display}手続きは循環オブジェクトに対してループしてはならなくなりました。

\item \rsixrs{}の手続き{\cf eof-object}が追加されました。
EOFオブジェクトは独立した型であることが要求されるようになりました。

\item 変数定義ができる場所ならどこでも構文定義ができるようになりました。

\item {\cf syntax-rules}構文は省略記号のシンボルを
デフォルトの{\cf ...}の代わりに明示的に指定できるようになり、
省略記号を接頭したリストによりテンプレートをエスケープできるようになり、
また省略記号のパターンに続く末尾のパターンを指定できるようになりました。

\item マクロ展開時に即座により詳細なエラーを通知する手段として
{\cf syntax-error}構文が追加されました。

\item {\cf letrec*} 束縛構文が追加され、
内部{\cf define}がそれを基に規定されるようになりました。

\item {\cf define-values}、{\cf let-values}および{\cf let*-values}
によって多値の捕捉に対するサポートが強化されました。
式の並びを持つ標準の式型は
その並びの最後以外のすべての式の継続にゼロ個または2個以上の値を
渡すことができるようになりました。

\item {\cf case}条件分岐で {\tt =>} 構文がサポートされるようになりました。
これは{\cf cond}の真似ですが、通常の節だけでなく{\cf else}節でも同様に使用できます。

\item 手続きに渡された引数の個数に基づいて分岐する
{\cf case-lambda}がそれ専用のライブラリに追加されました。

\item 便利な条件分岐{\cf when}および{\cf unless}が追加されました。

\item 不正確な数値に対する{\cf eqv?} の動作が
\rsixrs{}の定義に沿ったものになりました。

\item {\cf eq?} および{\cf eqv?} を手続きに適用した場合に
異なる答えを返すことが許されるようになりました。

\item \rsixrs{}の手続き{\cf boolean=?} および{\cf symbol=?} が追加されました。

\item 正の無限大、負の無限大、NaNおよび負の不正確なゼロが不正確な値として数塔に追加されました。
それぞれ {\tt +inf.0}、{\tt -inf.0}、{\tt +nan.0}、{\cf -0.0}と書き表されます。
これらのサポートは要求されません。
表現 {\tt -nan.0}は {\tt +nan.0}と同義です。

\item {\cf log}手続きは対数の底を指定する第2引数を取るようになりました。

\item 手続き{\cf map}および{\cf for-each}は
最も短いリストで停止することが要求されるようになりました。

\item 手続き{\cf member}および{\cf assoc}は
使用するべき等値述語を指定するオプショナルな第3引数を取るようになりました。

\item 数値手続き{\cf finite?}、{\cf infinite?}、{\cf nan?}、
{\cf exact-\+integer?}、{\cf square}および{\cf exact-\+integer-\+sqrt}
が追加されました。

\item {\cf -}、{\cf /} 手続きおよび文字比較、文字列比較の述語は
3つ以上の引数のサポートが要求されるようになりました。

\item 形式 \sharptrue{}および \sharpfalse{}が %
\schtrue{}および \schfalse{}と同様にサポートされるようになりました。

\item 手続き{\cf make-\+list}、{\cf list-\+copy}、{\cf list-\+set!}、
{\cf string-\+map}、{\cf string-\+for-\+each}、{\cf string->\+vector}、
{\cf vector-\+append}、
{\cf vector-\+copy}、{\cf vector-\+map}、{\cf vector-\+for-\+each}、
{\cf vector->\+string}、{\cf vector-\+copy!}、{\cf string-\+copy!}
がシーケンス操作の完全化のために追加されました。

\item 文字列およびベクタの手続きのいくつかは
オプショナルな\var{start}および\var{end}引数を用いた
文字列またはベクタの部分的な処理がサポートされます。

\item リストの手続きのいくつかは循環リストに対して定義されるようになりました。

\item 処理系はASCIIを含む完全なUnicodeレパートリーの任意のサブセットを
提供しても構いませんが、そういったサブセットは
Unicodeと矛盾しないようにサポートしなければなりません。
様々な文字および文字列の手続きがそれに従って拡張され、
文字列用の大文字小文字返還手続きが追加されました。
文字列の比較と文字の比較の一貫性を保つことはもはや要求されなくなりました。
文字の比較はUnicodeスカラー値にのみ基づいて行われます。
数値的な文字の数の値を取得する新しい{\cf digit-value}手続きが追加されました。

\item 2つのコメント構文、
次のデータムまでスキップするための {\tt \#;} および
ネスト可能なブロックコメントのための {\tt \#| ... |\#}
が追加されました。

\item データムラベル {\tt \#<n>=} を接頭したデータを {\tt \#<n>\#} で参照することができ、
共有構造を持つデータを読み書きできます。

\item 文字列およびシンボルで
ニーモニックおよび数値によるエスケープシーケンスが使えるようになり、
名前付き文字の一覧が拡張されました。

\item 手続き{\cf file-exists?} および{\cf delete-file}が
{\tt (scheme file)}ライブラリで利用可能です。

\item システム環境、コマンドライン、およびプロセスの終了状態へのインタフェースが
{\tt (scheme process-\+context)}ライブラリで利用可能です。

\item 時間関係の値にアクセスする手続きが{\tt (scheme time)}ライブラリで利用可能です。

\item 整数除算演算の変種の小さなセットが新しいより明確な名前で提供されています。

\item {\cf load}手続きはロード先の環境を指定する第2引数を取るようになりました。

\item {\cf call-with-current-continuation}手続きに
同義の{\cf call/cc}が追加されました。

\item read-eval-print loop の意味論が部分的に定められ、
手続きの再定義が遡って効果を持つよう要求されるようになりましたが、
構文キーワードはそうではありません。

\item 形式意味論で{\cf dynamic-wind}を処理するようになりました。
\end{itemize}

\subsection*{\rsixrs{}との非互換点}
この節では\rsevenrs{}と「報告書改$^6$」~\cite{R6RS}および
それに付属している標準ライブラリドキュメントの間の非互換点を列挙します。

{\em この一覧には権威がなく、不完全な可能性があります。}

\begin{itemize}
\item \rsevenrs{}のライブラリは{\cf library}ではなく
{\cf define-\+library}キーワードで始まります。
これは\rsixrs{}のライブラリと構文的に区別できるようにするためです。
\rsevenrs{}の用語で言うと、
\rsixrs{}のライブラリは単一のエクスポート宣言に続く単一のインポート宣言に続く
コマンドと定義から成ります。
\rsevenrs{}ではコマンドと定義は本体に直接書くことはできません。
それらは{\cf begin}ライブラリ宣言にラップする必要があります。

\item {\cf include}、{\cf include-\+ci}、{\cf include-\+library-\+declarations}
および{\cf cond-\+expand}ライブラリ宣言に直接対応するものは\rsixrs{}にありません。
一方で\rsevenrs{}のライブラリはフェーズやバージョン仕様をサポートしていません。

\item 標準化された識別子をライブラリにグループ化する方針が\rsixrs{}と異なっています。
特に明示的にせよ暗黙的にせよ\rfivers{}でオプショナルとなっている手続きは
baseライブラリから削除されました。
絶対的な要求事項はbaseライブラリのみです。

\item 識別子構文の形式は提供されません。

\item 内部構文定義は使用可能ですが、
定義されるよりも前にその構文形式の使用が現れることはできません。
\rsixrs{}にある{\cf even}/{\cf odd}の例は許容されません。

\item \rsixrs{}の例外システムはそのまま導入されましたが、
コンディション型は規定されていないままにしています。
特に\rsixrs{}では特定の型のコンディションの通知が要求されるところで
\rsevenrs{}では「それはエラーです」とだけ述べ、
通知の問題はオープンなままになっています。

\item 完全なUnicodeのサポートは要求されません。
正規化は提供されません。
文字の比較はUnicodeによって定義されますが、
文字列の比較は処理系依存です。
非Unicode文字が許容されています。

\item 完全な数塔は\rfivers{}と同様にオプショナルですが、
IEEEの無限大、NaN、{\mbox -0.0}のオプショナルなサポートが\rsixrs{}から採用されました。
数値の結果の明確化もほとんど採用されましたが、
\rsixrs{}の手続き{\cf real-valued?}、{\cf rational-valued?}
および{\cf integer-valued?} は採用されていません。
\rsixrs{}の除算演算子{\cf div}、{\cf mod}、{\cf div-\+and-\+mod}、
{\cf div0}、{\cf mod0}および{\cf div0-\+and-\+mod0}は提供されません。

\item 結果が規定されていないときでも、それが単一の値であることが要求されます。
しかし本体の最後でない式は任意の数の値を返せます。

\item {\cf map}および{\cf for-each}の意味論が変更され、
SRFI 1~\cite{srfi1}の早期終了動作を用いるようになりました。
同様に、{\cf assoc}および{\cf member}が変更され、
\rsixrs{}にある別個の{\cf assp}および{\cf memp}手続きの代わりに、
SRFI 1 のようにオプショナルな{\cf equal?} 引数を取るようになりました。

\item \rsixrs{}の{\cf quasiquote}の明確化が採用されました。
ただし{\cf unquote}および{\cf unquote-splicing}の多引数化は除かれています。

\item \rsixrs{}の仮数部の幅を指定する方法は採用されていません。

\item 文字列ポートは\rsixrs{}の代わりにSRFI 6~\cite{srfi6}と互換です。

\item \rsixrs{}形式のバイトベクタが導入されていますが、
符号無しバイト({\cf u8})の手続きのみ提供されています。
字句的構文は\rsixrs{}の{\cf \#vu8}形式ではなく
SRFI 4~\cite{srfi4}と互換性のある{\cf \#u8}を用います。

\item 便利なマクロ{\cf when}および{\cf unless}が提供されていますが、
結果は規定されていないままになっています。

\item 標準ライブラリドキュメントの残りの機能は
将来の標準化の努力に残されています。

\end{itemize}

